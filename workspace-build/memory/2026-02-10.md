# 2026-02-10 — Pip Build Session Notes

## Multi-Agent Routing Fix

### Problem

Bill's DMs to the **Pip** Discord bot (ID: `1466213865397162150`) were being routed to the **build** agent instead of the **main** agent. Bill kept getting Pip Build when he expected Pip.

### Root Causes Found & Fixed

1. **Build agent missing `workspace` config** — `agents.list` only had `{id: "build", model: {...}}` with no `workspace` field. It inherited `agents.defaults.workspace` (`/home/bill/.openclaw/workspace`) which is Pip main's workspace. Fix: added `"workspace": "/home/bill/.openclaw/workspace-build"` to the build agent entry.

2. **Main agent not in `agents.list`** — Only `build` was explicitly listed. The binding `{agentId: "main", match: {channel: "discord", accountId: "pip"}}` couldn't resolve because `main` wasn't in the agents list. The gateway fell back to the first (only) listed agent: `build`. Fix: added `{id: "main", default: true, workspace: "/home/bill/.openclaw/workspace"}` to `agents.list`.

3. **Top-level `channels.discord.token` was invalid** (401 Unauthorized) — a stale/expired token at the top level. Not the primary cause but could cause confusion. Bill provided the correct Pip main token and it was set on `channels.discord.accounts.pip.token`.

### Config Changes Made

- Added `main` agent to `agents.list` with `default: true`
- Added `workspace` to `build` agent in `agents.list`
- Updated `pip` Discord account token
- All via `gateway config.patch` (never direct file edits)

### Key Learnings

- `config.patch` on array items does **shallow merge by `id`** — if you patch only `{id, workspace}`, the existing `model` config gets dropped. Must include ALL fields when patching array items.
- The `main` agent must be explicitly in `agents.list` when other agents are listed, otherwise bindings referencing `main` may fail and fall back to the first listed agent.
- Token verification: `curl -s -H "Authorization: Bot $TOKEN" https://discord.com/api/v10/users/@me` to check which bot a token belongs to.
- Session metadata (`origin.accountId` in sessions.json) is useful for debugging routing — shows which Discord account actually received the message.

## Heartbeat Status

- Git backups running successfully (multiple commits pushed)
- Veritas Kanban board healthy — 5 tasks (2 todo, 3 done)
- Morning updates not yet run (will trigger first heartbeat after 8 AM tomorrow)
- `heartbeat-state.json` doesn't exist yet in workspace-build — needs to be created on first morning run
